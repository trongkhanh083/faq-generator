{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="mb-1"><i class="bi bi-check-circle-fill text-success me-2"></i>Generation Complete</h3>
                    <p class="mb-0 opacity-75">Your FAQs are ready to use</p>
                </div>
                <a href="/" class="btn btn-outline-light">
                    <i class="bi bi-plus-circle me-1"></i>New
                </a>
            </div>
            <div class="card-body p-4">
                <div class="result-metadata">
                    <div class="metadata-item">
                        <span class="metadata-label"><i class="bi bi-link-45deg me-1"></i>Source</span>
                        <span class="metadata-value text-truncate">{{ result.data.url }}</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label"><i class="bi bi-grid-3x3-gap me-1"></i>Platform</span>
                        <span class="metadata-value">
                            <span class="platform-badge">{{ result.data.platform|upper }}</span>
                        </span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label"><i class="bi bi-translate me-1"></i>Language</span>
                        <span class="metadata-value">{{ result.data.language|upper }}</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label"><i class="bi bi-list-ol me-1"></i>FAQs</span>
                        <span class="metadata-value">{{ result.data.faq_count }}</span>
                    </div>
                </div>
                
                <!-- Raw markdown content (hidden) -->
                <textarea id="rawMarkdown" style="display: none;">{{ result.data.faq_content }}</textarea>
                
                <!-- Rendered markdown content -->
                <div class="faq-content" id="renderedMarkdown"></div>
                
                <div class="d-flex gap-2 justify-content-center mt-4 flex-wrap">
                    <button class="btn btn-success" onclick="downloadFAQ()">
                        <i class="bi bi-download me-1"></i>Download
                    </button>
                    <button class="btn btn-outline-primary" onclick="copyToClipboard()">
                        <i class="bi bi-clipboard me-1"></i>Copy
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Render markdown when page loads
document.addEventListener('DOMContentLoaded', function() {
    const rawMarkdown = document.getElementById('rawMarkdown').value;
    const renderedElement = document.getElementById('renderedMarkdown');
    
    // Configure marked options
    marked.setOptions({
        breaks: true,
        gfm: true,
        highlight: function(code, lang) {
            return code;
        }
    });
    
    // Render markdown to HTML
    renderedElement.innerHTML = marked.parse(rawMarkdown);
    
    // Add styling to rendered content
    const faqItems = renderedElement.querySelectorAll('strong');
    faqItems.forEach(item => {
        item.style.color = 'var(--primary)';
        item.style.fontSize = '1.1em';
        item.style.marginBottom = '0.5rem';
        item.style.display = 'block';
    });
});

function downloadFAQ() {
    const content = document.getElementById('rawMarkdown').value;
    const blob = new Blob([content], { type: 'text/markdown' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'social_media_faqs.md';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    // Show feedback
    showToast('Download started!', 'success');
}

function copyToClipboard() {
    const content = document.getElementById('rawMarkdown').value;
    navigator.clipboard.writeText(content).then(() => {
        showToast('Copied to clipboard!', 'success');
    }).catch(err => {
        showToast('Failed to copy', 'error');
    });
}

function showToast(message, type = 'info') {
    // Simple toast implementation
    const toast = document.createElement('div');
    toast.style = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 12px 20px;
        background: ${type === 'success' ? 'var(--success)' : 'var(--primary)'};
        color: white;
        border-radius: 8px;
        box-shadow: var(--card-shadow);
        z-index: 1000;
    `;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        document.body.removeChild(toast);
    }, 3000);
}
</script>
{% endblock %}